bun test v1.2.14 (6a363a38)

backend/test/providers-registry.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find package 'pino' from '/app/backend/src/logger.ts'
-------------------------------


backend/test/auth.test.ts:

backend/test/orchestration.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find package 'nanoid' from '/app/backend/src/kory/manager.ts'
-------------------------------


backend/test/api.test.ts:

# Unhandled error between tests
-------------------------------
52 |     } catch {
53 |       // Retry until timeout
54 |     }
55 |     await new Promise((r) => setTimeout(r, 250));
56 |   }
57 |   throw new Error(`Backend did not become ready on ${BASE_URL} within ${timeoutMs}ms`);
             ^
error: Backend did not become ready on http://127.0.0.1:3301 within 20000ms
      at waitForServerReady (/app/backend/test/api.test.ts:57:9)
      at <anonymous> (/app/backend/test/api.test.ts:80:3)
      at /app/backend/test/api.test.ts:79:1
      at loadAndEvaluateModule (2:1)
-------------------------------

(fail) API Integration Tests > GET /api/health > returns health status
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:95:19)
      at <anonymous> (/app/backend/test/api.test.ts:94:54)
(fail) API Integration Tests > Sessions API > POST /api/sessions creates a new session [12.64ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:110:19)
      at <anonymous> (/app/backend/test/api.test.ts:109:50)
(fail) API Integration Tests > Sessions API > GET /api/sessions lists all sessions [16.12ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 3 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:119:19)
      at <anonymous> (/app/backend/test/api.test.ts:118:59)
(fail) API Integration Tests > Sessions API > GET /api/sessions/:id returns session details [22.21ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 1 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:128:19)
      at <anonymous> (/app/backend/test/api.test.ts:126:59)
(fail) API Integration Tests > Sessions API > PATCH /api/sessions/:id updates session title [22.96ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:140:19)
      at <anonymous> (/app/backend/test/api.test.ts:139:58)
(fail) API Integration Tests > Sessions API > GET /api/sessions/:id/messages returns array [13.41ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:148:19)
      at <anonymous> (/app/backend/test/api.test.ts:147:54)
(fail) API Integration Tests > Sessions API > DELETE /api/sessions/:id deletes session [18.30ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:159:19)
      at <anonymous> (/app/backend/test/api.test.ts:158:56)
(fail) API Integration Tests > Providers API > GET /api/providers returns provider status [17.64ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 6 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:167:19)
      at <anonymous> (/app/backend/test/api.test.ts:166:67)
(fail) API Integration Tests > Providers API > PUT /api/providers/copilot rejects apiKey (auth-only) [23.91ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 2 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:179:19)
      at <anonymous> (/app/backend/test/api.test.ts:178:62)
(fail) API Integration Tests > Providers API > PUT /api/providers/openai rejects missing apiKey [15.03ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:191:19)
      at <anonymous> (/app/backend/test/api.test.ts:190:88)
(fail) API Integration Tests > Providers API > PUT /api/providers/anthropic accepts dual-mode payload shape and validates [12.38ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:203:19)
      at <anonymous> (/app/backend/test/api.test.ts:202:55)
(fail) API Integration Tests > Providers API > PUT /api/providers/local requires baseUrl [23.62ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 1 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:217:19)
      at <anonymous> (/app/backend/test/api.test.ts:216:57)
(fail) API Integration Tests > Agents API > GET /api/agents/status returns agent status [14.28ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:227:19)
      at <anonymous> (/app/backend/test/api.test.ts:226:40)
(fail) API Integration Tests > Input Validation > rejects invalid session ID [21.52ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:235:19)
      at <anonymous> (/app/backend/test/api.test.ts:233:59)
(fail) API Integration Tests > Input Validation > rejects oversized session title by truncating [12.90ms]
24 |   }
25 |
26 |   const proc = Bun.spawnSync(["curl", ...args], { stdout: "pipe", stderr: "pipe" });
27 |   if (proc.exitCode !== 0) {
28 |     const stderr = proc.stderr ? new TextDecoder().decode(proc.stderr) : "";
29 |     throw new Error(stderr || `curl exited ${proc.exitCode}`);
               ^
error: curl: (7) Failed to connect to 127.0.0.1 port 3301 after 0 ms: Couldn't connect to server

      at request (/app/backend/test/api.test.ts:29:11)
      at <anonymous> (/app/backend/test/api.test.ts:248:19)
      at <anonymous> (/app/backend/test/api.test.ts:247:47)
(fail) API Integration Tests > CORS Headers > handles preflight OPTIONS request [15.07ms]

backend/test/security.test.ts:

# Unhandled error between tests
-------------------------------
-------------------------------


 0 pass
 20 fail
 4 errors
Ran 20 tests across 5 files. [20.45s]
